<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Sou Net</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        /* ESTILS CLEAN UI (Inputs Invisibles) */
        .clean-input {
            background: transparent;
            border: none;
            color: inherit;
            font-family: inherit;
            font-weight: 700;
            font-size: 1.2rem; /* Forcem mida idèntica al text */
            width: 100%;
            padding: 0;
            margin: 0;
            outline: none;
            cursor: text;
            transition: color 0.2s;
            -moz-appearance: textfield;
        }
        .clean-input::-webkit-outer-spin-button,
        .clean-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .clean-input:focus { border-bottom: 2px solid var(--accent); border-radius: 0; }

        .input-display-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 10px;
        }
        .currency-wrapper {
            display: flex;
            align-items: baseline;
            font-size: 1.2rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        /* RESULTATS DUALS */
        .salary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .salary-option {
            background: #fff;
            border: 1px solid var(--border-light);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.2s;
        }
        .salary-option.highlight {
            border-color: var(--accent);
            background: rgba(0, 113, 227, 0.03);
        }
        .salary-label { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 8px; display: block; }
        .salary-val { font-size: 1.8rem; font-weight: 700; color: var(--text-primary); }
        
        /* DETALLS */
        .breakdown {
            margin-top: 30px;
            font-size: 0.9rem;
            border-top: 1px solid var(--border-light);
            padding-top: 20px;
        }
        .breakdown-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }
        .breakdown-row.total {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1rem;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #eee;
        }
    </style>
</head>
<body>

    <nav class="top-nav">
        <a href="../index.html" class="btn-back">Menú Principal</a>
    </nav>

    <div class="container">
        <h2>Calculadora Sou Net</h2>
        <p style="text-align:center; color:var(--text-secondary); margin-top:-20px; margin-bottom:30px; font-size:0.9rem;">
            Estimació precisa segons IRPF i Seguretat Social (Espanya 2025).
        </p>

        <div class="results-box" style="background: transparent; padding: 0; text-align: left;">
            <div class="salary-grid">
                <div class="salary-option highlight" id="box-12">
                    <span class="salary-label">En 12 Pagues</span>
                    <div class="salary-val" id="res-12">0 €</div>
                    <span style="font-size:0.75rem; color:#999">al mes</span>
                </div>
                <div class="salary-option" id="box-14">
                    <span class="salary-label">En 14 Pagues</span>
                    <div class="salary-val" id="res-14">0 €</div>
                    <span style="font-size:0.75rem; color:#999">al mes + 2 extres</span>
                </div>
            </div>

            <div class="breakdown">
                <div class="breakdown-row">
                    <span>Sou Brut Mensual (12 pagues)</span>
                    <span id="d-gross-month">0 €</span>
                </div>
                <div class="breakdown-row">
                    <span>Retenció IRPF (<span id="d-irpf-rate">0%</span>)</span>
                    <span id="d-irpf-val" style="color:#e74c3c">-0 €</span>
                </div>
                <div class="breakdown-row">
                    <span>Seguretat Social (6.35%)</span>
                    <span id="d-ss-val" style="color:#e74c3c">-0 €</span>
                </div>
                <div class="breakdown-row total">
                    <span>TOTAL A REBRE (NET)</span>
                    <span id="d-net-total">0 €</span>
                </div>
            </div>
        </div>

        <hr style="border:0; border-top:1px solid var(--border-light); margin: 40px 0;">

        <div class="control-group">
            <div class="input-display-row">
                <label>Salari Brut Anual</label>
                <div class="currency-wrapper">
                    <input type="number" id="in-salary-num" class="clean-input" value="30000" step="500" style="text-align: right; width: 110px;">
                    <span style="margin-left:4px">€</span>
                </div>
            </div>
            <input type="range" id="in-salary" min="12000" max="120000" step="500" value="30000">
        </div>

        <div class="control-group">
            <div class="input-display-row">
                <label>Edat</label>
                <div class="currency-wrapper">
                    <input type="number" id="in-age-num" class="clean-input" value="30" step="1" style="text-align: right; width: 60px;">
                    <span style="margin-left:4px">anys</span>
                </div>
            </div>
            <input type="range" id="in-age" min="18" max="70" step="1" value="30">
        </div>

        <div class="control-group">
            <div class="input-display-row">
                <label>Fills (menors 25)</label>
                <div class="currency-wrapper">
                    <input type="number" id="in-kids-num" class="clean-input" value="0" step="1" min="0" max="10" style="text-align: right; width: 50px;">
                </div>
            </div>
            <input type="range" id="in-kids" min="0" max="5" step="1" value="0">
        </div>
        
        <p style="font-size: 0.75rem; color: #b2bec3; text-align: center; margin-top: 30px; line-height: 1.4;">
            *Nota: Aquesta eina proporciona una estimació propera a la realitat aplicant les taules estatals generals.
        </p>
    </div>

<script>
    const els = {
        // Sliders
        salary: document.getElementById('in-salary'),
        age: document.getElementById('in-age'),
        kids: document.getElementById('in-kids'),
        
        // Numeric Inputs
        salaryNum: document.getElementById('in-salary-num'),
        ageNum: document.getElementById('in-age-num'),
        kidsNum: document.getElementById('in-kids-num'),

        // Results Display
        r12: document.getElementById('res-12'),
        r14: document.getElementById('res-14'),
        dGross: document.getElementById('d-gross-month'),
        dIrpfRate: document.getElementById('d-irpf-rate'),
        dIrpfVal: document.getElementById('d-irpf-val'),
        dSsVal: document.getElementById('d-ss-val'),
        dNetTotal: document.getElementById('d-net-total')
    };

    function calculateTax(gross, kids) {
        // 1. Seguretat Social (Base Màxima 2024 aprox 4720€/mes -> 56640€ anuals)
        let ssBase = gross;
        if (gross > 56640) ssBase = 56640;
        if (gross < 13230) ssBase = 13230; 
        
        let ssTotal = ssBase * 0.0635; 

        // 2. Mínims Exempts
        let personalMin = 5550; 
        let kidsMin = 0;
        if (kids >= 1) kidsMin += 2400;
        if (kids >= 2) kidsMin += 2700;
        if (kids >= 3) kidsMin += 4000;
        if (kids >= 4) kidsMin += 4500;

        let totalExempt = personalMin + kidsMin;

        // 3. IRPF Progressiu (Simplificat Estatal)
        const brackets = [
            { limit: 12450, rate: 0.19 },
            { limit: 20200, rate: 0.24 },
            { limit: 35200, rate: 0.30 },
            { limit: 60000, rate: 0.37 },
            { limit: 300000, rate: 0.45 },
            { limit: Infinity, rate: 0.47 }
        ];

        function getTaxForAmount(amount) {
            let tax = 0;
            let currentPos = 0;
            for (let b of brackets) {
                if (amount > currentPos) {
                    let taxable = Math.min(amount, b.limit) - currentPos;
                    tax += taxable * b.rate;
                    currentPos = b.limit;
                } else {
                    break;
                }
            }
            return tax;
        }

        let fullTax = getTaxForAmount(gross);
        let exemptTax = getTaxForAmount(totalExempt); 

        let finalIrpf = fullTax - exemptTax;
        if (finalIrpf < 0) finalIrpf = 0;

        // Ajust rendes baixes
        if (gross < 22000) finalIrpf = finalIrpf * 0.85; 
        if (gross < 15876) finalIrpf = 0;

        return {
            ss: ssTotal,
            irpf: finalIrpf,
            net: gross - ssTotal - finalIrpf
        };
    }

    function update(source, type) {
        // Sincronització Bidireccional
        let val;

        if (type === 'salary') {
            val = parseFloat(source === 'slider' ? els.salary.value : els.salaryNum.value);
            if (isNaN(val)) val = 0;
            els.salary.value = val;
            els.salaryNum.value = val;
        }
        if (type === 'age') {
            val = parseFloat(source === 'slider' ? els.age.value : els.ageNum.value);
            if (isNaN(val)) val = 0;
            els.age.value = val;
            els.ageNum.value = val;
        }
        if (type === 'kids') {
            val = parseFloat(source === 'slider' ? els.kids.value : els.kidsNum.value);
            if (isNaN(val)) val = 0;
            els.kids.value = val;
            els.kidsNum.value = val;
        }

        // Obtenir valors finals
        let gross = parseFloat(els.salaryNum.value);
        let kids = parseFloat(els.kidsNum.value);

        let result = calculateTax(gross, kids);
        let netAnnual = result.net;
        
        // Display Logic
        let irpfPercent = (gross > 0) ? (result.irpf / gross) * 100 : 0;

        els.r12.textContent = Math.floor(netAnnual / 12).toLocaleString('ca-ES') + " €";
        els.r14.textContent = Math.floor(netAnnual / 14).toLocaleString('ca-ES') + " €";

        els.dGross.textContent = (gross / 12).toFixed(0).toLocaleString('ca-ES') + " €";
        els.dIrpfRate.textContent = irpfPercent.toFixed(1) + "%";
        els.dIrpfVal.textContent = "-" + (result.irpf / 12).toFixed(0).toLocaleString('ca-ES') + " €";
        els.dSsVal.textContent = "-" + (result.ss / 12).toFixed(0).toLocaleString('ca-ES') + " €";
        els.dNetTotal.textContent = Math.floor(netAnnual / 12).toLocaleString('ca-ES') + " €";
    }

    // Listeners
    // Salari
    els.salary.addEventListener('input', () => update('slider', 'salary'));
    els.salaryNum.addEventListener('input', () => update('num', 'salary'));
    
    // Edat
    els.age.addEventListener('input', () => update('slider', 'age'));
    els.ageNum.addEventListener('input', () => update('num', 'age'));

    // Fills
    els.kids.addEventListener('input', () => update('slider', 'kids'));
    els.kidsNum.addEventListener('input', () => update('num', 'kids'));
    
    update('num', 'salary'); // Init
</script>
</body>
</html>