<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Préstec Personal / Cotxe</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        /* CLEAN UI STYLES */
        .clean-input {
            background: transparent;
            border: none;
            color: inherit;
            font-family: inherit;
            font-weight: 700;
            font-size: 1.2rem; /* Mida gran igualada */
            width: 100%;
            padding: 0;
            margin: 0;
            outline: none;
            cursor: text;
            transition: color 0.2s;
            -moz-appearance: textfield;
        }
        .clean-input::-webkit-outer-spin-button,
        .clean-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .clean-input:focus { border-bottom: 2px solid var(--accent); border-radius: 0; }

        .input-display-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 10px;
        }
        .currency-wrapper {
            display: flex;
            align-items: baseline;
            font-size: 1.2rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        /* Rebut */
        .receipt-box {
            background: #fff;
            border: 1px dashed #b2bec3;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            position: relative;
        }
        .receipt-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .receipt-row.final {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.1rem;
            border-top: 2px solid var(--text-primary);
            padding-top: 10px;
            margin-top: 15px;
        }
        
        /* Pie Chart */
        .pie-chart-wrapper {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--accent) 0% 80%, #e74c3c 80% 100%);
            margin: 0 auto 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pie-inner {
            width: 90px;
            height: 90px;
            background: #f5f5f7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            flex-direction: column;
        }
    </style>
</head>
<body>

    <nav class="top-nav">
        <a href="../index.html" class="btn-back">Menú Principal</a>
    </nav>

    <div class="container">
        <h2>Préstec Personal i Cotxe</h2>
        <p style="text-align:center; color:var(--text-secondary); margin-top:-20px; margin-bottom:30px; font-size:0.9rem;">
            Calcula la quota real d'un cotxe, reforma o crèdit al consum.
        </p>

        <div class="results-box">
            <div class="pie-chart-wrapper" id="chart-pie">
                <div class="pie-inner">
                    <span style="color:#e74c3c" id="d-percent-int">0%</span>
                    <span style="font-size:0.7em; color:#999">Interès</span>
                </div>
            </div>

            <div style="text-align:center; font-size:0.9em; color:var(--text-secondary);">Quota Mensual a Pagar</div>
            <div class="big-number" id="d-monthly">0 €</div>

            <div class="receipt-box">
                <div class="receipt-row">
                    <span>Diners Sol·licitats:</span>
                    <span id="d-principal">0 €</span>
                </div>
                <div class="receipt-row">
                    <span style="color:#e74c3c">Cost dels Interessos:</span>
                    <span style="color:#e74c3c" id="d-interest">0 €</span>
                </div>
                <div class="receipt-row final">
                    <span>TOTAL REAL A TORNAR:</span>
                    <span id="d-total">0 €</span>
                </div>
            </div>
        </div>

        <div class="control-group">
            <div class="input-display-row">
                <label>Import a Demanar</label>
                <div class="currency-wrapper">
                    <input type="number" id="in-amount-num" class="clean-input" value="15000" step="500" style="text-align: right; width: 100px;">
                    <span style="margin-left:4px">€</span>
                </div>
            </div>
            <input type="range" id="in-amount" min="1000" max="60000" step="500" value="15000">
        </div>

        <div class="control-group">
            <div class="input-display-row">
                <label>Interès Anual (TIN)</label>
                <div class="currency-wrapper">
                    <input type="number" id="in-rate-num" class="clean-input" value="7.5" step="0.1" style="text-align: right; width: 60px;">
                    <span style="margin-left:4px">%</span>
                </div>
            </div>
            <input type="range" id="in-rate" min="2" max="20" step="0.1" value="7.5">
            <p style="font-size:0.75rem; color:#b2bec3; margin-top:5px;">*Préstecs cotxe solen ser 6-9%. Targetes >18%.</p>
        </div>

        <div class="control-group">
            <div class="input-display-row">
                <label>Durada (<span id="d-years-text" style="font-weight:normal">5 anys</span>)</label>
                <div class="currency-wrapper">
                    <input type="number" id="in-months-num" class="clean-input" value="60" step="1" style="text-align: right; width: 60px;">
                    <span style="margin-left:4px">mesos</span>
                </div>
            </div>
            <input type="range" id="in-months" min="12" max="120" step="6" value="60">
        </div>
    </div>

<script>
    const els = {
        // Sliders
        amount: document.getElementById('in-amount'),
        rate: document.getElementById('in-rate'),
        months: document.getElementById('in-months'),
        
        // Numeric Inputs
        amountNum: document.getElementById('in-amount-num'),
        rateNum: document.getElementById('in-rate-num'),
        monthsNum: document.getElementById('in-months-num'),

        // Visuals
        yearsText: document.getElementById('d-years-text'),
        dMonthly: document.getElementById('d-monthly'),
        dPrincipal: document.getElementById('d-principal'),
        dInterest: document.getElementById('d-interest'),
        dTotal: document.getElementById('d-total'),
        dPercentInt: document.getElementById('d-percent-int'),
        pie: document.getElementById('chart-pie')
    };

    function update(source, type) {
        let val;

        // Sincronització
        if (type === 'amount') {
            val = parseFloat(source === 'slider' ? els.amount.value : els.amountNum.value);
            if (isNaN(val)) val = 0;
            els.amount.value = val;
            els.amountNum.value = val;
        }
        if (type === 'rate') {
            val = parseFloat(source === 'slider' ? els.rate.value : els.rateNum.value);
            if (isNaN(val)) val = 0;
            els.rate.value = val;
            els.rateNum.value = val;
        }
        if (type === 'months') {
            val = parseFloat(source === 'slider' ? els.months.value : els.monthsNum.value);
            if (isNaN(val)) val = 0;
            els.months.value = val;
            els.monthsNum.value = val;
        }

        // Càlcul
        let P = parseFloat(els.amountNum.value);
        let annualRate = parseFloat(els.rateNum.value);
        let n = parseFloat(els.monthsNum.value);

        // Actualitzar text "anys"
        let years = (n / 12).toFixed(1);
        if (years.endsWith('.0')) years = years.slice(0, -2);
        els.yearsText.textContent = years + " anys";

        // Mètode Francès
        let r = (annualRate / 100) / 12;
        let monthlyPayment = 0;
        
        if (annualRate === 0) {
            monthlyPayment = P / n;
        } else {
            monthlyPayment = P * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        }

        let totalPaid = monthlyPayment * n;
        let totalInterest = totalPaid - P;

        // Resultats UI
        els.dMonthly.textContent = Math.floor(monthlyPayment).toLocaleString('ca-ES') + " €";
        els.dPrincipal.textContent = P.toLocaleString('ca-ES') + " €";
        els.dInterest.textContent = Math.floor(totalInterest).toLocaleString('ca-ES') + " €";
        els.dTotal.textContent = Math.floor(totalPaid).toLocaleString('ca-ES') + " €";

        // Chart
        let percentInterest = (totalInterest / totalPaid) * 100;
        let percentPrincipal = 100 - percentInterest;
        
        els.pie.style.background = `conic-gradient(var(--accent) 0% ${percentPrincipal}%, #e74c3c ${percentPrincipal}% 100%)`;
        els.dPercentInt.textContent = percentInterest.toFixed(0) + "%";
    }

    // Listeners
    els.amount.addEventListener('input', () => update('slider', 'amount'));
    els.amountNum.addEventListener('input', () => update('num', 'amount'));

    els.rate.addEventListener('input', () => update('slider', 'rate'));
    els.rateNum.addEventListener('input', () => update('num', 'rate'));

    els.months.addEventListener('input', () => update('slider', 'months'));
    els.monthsNum.addEventListener('input', () => update('num', 'months'));
    
    update('num', 'amount');
</script>
</body>
</html>